<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Bluetooth Robot Controller</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation; /* Prevents double-tap zoom on buttons */
        }
        .control-btn {
            transition: all 0.1s ease-in-out;
            user-select: none; /* Prevents text selection on long press */
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent; /* Removes tap highlight on mobile */
        }
        .control-btn:active {
            transform: scale(0.95);
            filter: brightness(0.8);
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-sm mx-auto bg-gray-800 rounded-2xl shadow-2xl p-6">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-xl font-bold text-cyan-400">Robot Controller</h1>
            <div id="status" class="flex items-center space-x-2 text-sm font-medium">
                <div id="status-light" class="w-3 h-3 rounded-full bg-red-500"></div>
                <span id="status-text">Disconnected</span>
            </div>
        </div>

        <button id="connect-btn" class="w-full bg-cyan-500 hover:bg-cyan-600 text-gray-900 font-bold py-3 px-4 rounded-lg mb-6 transition-colors duration-200">
            Connect to Robot
        </button>

        <!-- Main D-Pad Controls -->
        <div class="grid grid-cols-3 gap-4 mb-6">
            <!-- Top Row -->
            <button data-command="Q" class="control-btn bg-gray-700 rounded-lg p-4 flex items-center justify-center aspect-square">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16"><path d="M9.224 1.553a.5.5 0 0 1 .223.67L6.56 8l2.888 5.776a.5.5 0 1 1-.894.448l-3-6a.5.5 0 0 1 0-.448l3-6a.5.5 0 0 1 .67-.223z"/></svg>
            </button>
            <button data-command="F" class="control-btn bg-gray-700 rounded-lg p-4 flex items-center justify-center aspect-square">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"/></svg>
            </button>
            <button data-command="E" class="control-btn bg-gray-700 rounded-lg p-4 flex items-center justify-center aspect-square">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16"><path d="M6.776 1.553a.5.5 0 0 1 .671.223l3 6a.5.5 0 0 1 0 .448l-3 6a.5.5 0 1 1-.894-.448L9.44 8 6.553 2.224a.5.5 0 0 1 .223-.671z"/></svg>
            </button>

            <!-- Middle Row -->
            <button data-command="L" class="control-btn bg-gray-700 rounded-lg p-4 flex items-center justify-center aspect-square">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16"><path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"/></svg>
            </button>
            <div class="bg-gray-800 rounded-lg p-4 flex items-center justify-center aspect-square text-red-500 font-bold text-lg">STOP</div>
            <button data-command="R" class="control-btn bg-gray-700 rounded-lg p-4 flex items-center justify-center aspect-square">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16"><path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/></svg>
            </button>

            <!-- Bottom Row -->
            <button data-command="Z" class="control-btn bg-gray-700 rounded-lg p-4 flex items-center justify-center aspect-square">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="transform rotate-180" viewBox="0 0 16 16"><path d="M6.776 1.553a.5.5 0 0 1 .671.223l3 6a.5.5 0 0 1 0 .448l-3 6a.5.5 0 1 1-.894-.448L9.44 8 6.553 2.224a.5.5 0 0 1 .223-.671z"/></svg>
            </button>
            <button data-command="B" class="control-btn bg-gray-700 rounded-lg p-4 flex items-center justify-center aspect-square">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16"><path d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"/></svg>
            </button>
            <button data-command="C" class="control-btn bg-gray-700 rounded-lg p-4 flex items-center justify-center aspect-square">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="transform rotate-180" viewBox="0 0 16 16"><path d="M9.224 1.553a.5.5 0 0 1 .223.67L6.56 8l2.888 5.776a.5.5 0 1 1-.894.448l-3-6a.5.5 0 0 1 0-.448l3-6a.5.5 0 0 1 .67-.223z"/></svg>
            </button>
        </div>

        <!-- Special Command -->
        <button id="turn-180-btn" data-command="T" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-200">
            Turn 180Â°
        </button>
    </div>

    <script>
        // DOM Elements
        const connectButton = document.getElementById('connect-btn');
        const statusText = document.getElementById('status-text');
        const statusLight = document.getElementById('status-light');
        const controlButtons = document.querySelectorAll('.control-btn');
        const turn180Button = document.getElementById('turn-180-btn');

        // Bluetooth variables
        let bluetoothDevice;
        let txCharacteristic;
        const UART_SERVICE_UUID = "00001101-0000-1000-8000-00805f9b34fb"; // Standard Serial Port Service
        const UART_TX_CHARACTERISTIC_UUID = "00001101-0000-1000-8000-00805f9b34fb"; // Same for TX on many modules

        // --- Connection Logic ---
        connectButton.addEventListener('click', async () => {
            if (!navigator.bluetooth) {
                alert('Web Bluetooth API is not available in this browser. Please use Chrome on Android, macOS, or Windows.');
                return;
            }

            try {
                updateStatus('Requesting device...');
                bluetoothDevice = await navigator.bluetooth.requestDevice({
                    filters: [{ services: [UART_SERVICE_UUID] }],
                    optionalServices: [UART_SERVICE_UUID]
                });

                updateStatus('Connecting to GATT Server...');
                bluetoothDevice.addEventListener('gattserverdisconnected', onDisconnected);
                const server = await bluetoothDevice.gatt.connect();

                updateStatus('Getting Service...');
                const service = await server.getPrimaryService(UART_SERVICE_UUID);

                updateStatus('Getting Characteristic...');
                txCharacteristic = await service.getCharacteristic(UART_TX_CHARACTERISTIC_UUID);

                updateStatus('Connected', true);
                connectButton.disabled = true;
                connectButton.classList.add('opacity-50', 'cursor-not-allowed');

            } catch (error) {
                console.error('Connection failed:', error);
                updateStatus(`Error: ${error.message}`);
            }
        });

        function onDisconnected() {
            updateStatus('Disconnected');
            txCharacteristic = null;
            bluetoothDevice = null;
            connectButton.disabled = false;
            connectButton.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // --- Command Sending Logic ---
        async function sendCommand(command) {
            if (!txCharacteristic) {
                console.warn('Not connected, cannot send command.');
                return;
            }
            try {
                const encoder = new TextEncoder();
                await txCharacteristic.writeValue(encoder.encode(command));
            } catch (error) {
                console.error('Failed to send command:', error);
            }
        }
        
        // --- Event Listeners for Movement Buttons ---
        // These events ensure the robot stops when the button is released.
        const startEvents = ['mousedown', 'touchstart'];
        const endEvents = ['mouseup', 'mouseleave', 'touchend'];

        controlButtons.forEach(button => {
            const command = button.dataset.command;
            startEvents.forEach(event => {
                button.addEventListener(event, (e) => {
                    e.preventDefault(); // Prevents unwanted behavior like scrolling
                    sendCommand(command);
                });
            });
            endEvents.forEach(event => {
                button.addEventListener(event, (e) => {
                    e.preventDefault();
                    sendCommand('S'); // Send STOP command on release
                });
            });
        });
        
        // Special button for a single action (no stop on release)
        turn180Button.addEventListener('click', () => {
            sendCommand('T');
        });

        // --- UI Update Function ---
        function updateStatus(message, isConnected = false) {
            console.log(message);
            statusText.textContent = message;
            if (isConnected) {
                statusLight.classList.remove('bg-red-500', 'animate-pulse');
                statusLight.classList.add('bg-green-500');
            } else if (message.includes('Connecting') || message.includes('Requesting')) {
                 statusLight.classList.remove('bg-red-500', 'bg-green-500');
                 statusLight.classList.add('bg-yellow-500', 'animate-pulse');
            }
            else {
                statusLight.classList.remove('bg-green-500', 'bg-yellow-500', 'animate-pulse');
                statusLight.classList.add('bg-red-500');
            }
        }
    </script>
</body>
</html>

